# v3.0
- result中是训练280个epoch的测试结果
  - epoch:279 iter:150300 Loss:22.5622
  - test epoch:279 Loss:6.6709

- 训练的代码不是DAINet-ciconv_3.0，以下内容无效
  - 训练150个epoch，60400个iter，在第94个epoch获得最后一次最优权重
    - 训练记录
        Timer: 0.4522
        epoch:94 || iter:37900 || Loss:4.5703
        ->> pal1 conf loss:1.4853 || pal1 loc loss:1.0480
        ->> pal2 conf loss:1.2227 || pal2 loc loss:0.8144
        ->>lr:1.4142000000000002e-06
        Timer: 0.4629
        epoch:94 || iter:38000 || Loss:4.3495
        ->> pal1 conf loss:1.3748 || pal1 loc loss:0.9858
        ->> pal2 conf loss:1.1639 || pal2 loc loss:0.8251
        ->>lr:1.4142000000000002e-06
        Timer: 0.4517
        epoch:94 || iter:38100 || Loss:4.3821
        ->> pal1 conf loss:1.3775 || pal1 loc loss:1.0053
        ->> pal2 conf loss:1.1628 || pal2 loc loss:0.8364
        ->>lr:1.4142000000000002e-06
        Timer: 0.4488
        epoch:94 || iter:38200 || Loss:4.3420
        ->> pal1 conf loss:1.3631 || pal1 loc loss:0.9957
        ->> pal2 conf loss:1.1520 || pal2 loc loss:0.8311
        ->>lr:1.4142000000000002e-06
        Timer: 22.1282
        test epoch:94 || Loss:5.4419
        Saving best state,epoch 94
    - 权重文件保存为dyan_v3.0.pth
- 重新训练 找到一个更优的解
  - 得到一组权重文件 精简测试集保留前500个样本 并逐个权重进行test
    - dyan.pth 
    - dyan_60000 3693
    - dyan_55000 3698
    - dyan_5000  2484
```python
# 单通道边缘图显示方法
image = inv_out[ 0 ].detach().cpu().numpy().squeeze()  # 维度 [H, W]

# 归一化到对称范围
vmax = np.max( np.abs( image ) )
image_normalized = image / vmax  # 范围[-1, 1]

# 使用红蓝颜色映射可视化
plt.imshow( image_normalized , cmap = 'RdBu' , vmin = -1 , vmax = 1 )
plt.axis( 'off' )
plt.colorbar( label = 'Edge Strength (Red: Positive, Blue: Negative)' )
plt.show()
# 保存图像到文件
plt.savefig( f'ciconv.png' , bbox_inches = 'tight' , pad_inches = 0 , dpi = 800 )
```

```python
# 查询cpu核心数，用来调整worker数——一般为核心数的0.5-0.75
print(f'cpus num = {os.cpu_count()}') #112
```

```bash
CUDA_VISIBLE_DEVICES=3 python -m torch.distributed.launch --nproc_per_node=1 train.py
```

```bash
tmux窗口下，ctrl + b 再加 [ 可以启动复制模式,鼠标任意滚动
或者 输入指令 tmux set -g mouse on
```

```bash
启动mAP计算
python main.py --no-animation --no-plot --quiet
```
